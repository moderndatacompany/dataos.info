---
title: "Lens Development Environment"
---

<Info>
  Testing Lens in the development environment is an optional step.
</Info>

## Prerequisites

Before setting up Lens, make sure all required dependencies are installed. Follow theÂ [Prerequisites for Lens](https://dataos.info/resources/lens/installing_prerequisites/)Â guide for detailed instructions and resources to ensure a seamless installation and configuration process.



Running and testing models in the development environment allows you to catch and resolve potential issues early, which helps streamline the development process and ensures smoother deployments with reduced risk of complications in production.

## Add aÂ `docker-compose.yml`Â manifest file

To do local testing, addÂ `docker-compose.yml`Â manifest file. This file allows to simulate the environment locally, ensuring that all necessary components are properly configured. TheÂ `docker-compose.yml`Â file defines how to set up and run Docker containers for Lens.

> Always create the docker-compose.yml file in parallel to the model directory.

<Accordion title="To view the docker-compose.yml manifest file, click here." defaultOpen={false}>
  ```yaml
  version: "2.2"

  x-lens2-environment: &lens2-environment

  # DataOS

  DATAOS_FQDN: <dataos_fqdn>.dataos.app #add the URL for the environment. Ensure you are passing the API key for this env

  # Overview

  LENS2_NAME: lens_name
  LENS2_DESCRIPTION: "Purpose of the lens"
  LENS2_TAGS: "lens2, ecommerce, sales and customer insights" #add tags for better discoverability
  LENS2_AUTHORS: "author_name" #add the owner name here
  LENS2_SCHEDULED_REFRESH_TIMEZONES: "UTC,America/Vancouver,America/Toronto"

  # Data Source

  # This defines env variables for connecting to the source via the 

  LENS2_SOURCE_TYPE: ${}
  LENS2_SOURCE_NAME: ${depot_name}
  LENS2_SOURCE_CATALOG_NAME: ${catalog_name}
  DATAOS_RUN_AS_APIKEY: ******   #USER APIKEY

  # Log

  LENS2_LOG_LEVEL: error
  CACHE_LOG_LEVEL: "trace"

  # Operation

  LENS2_DEV_MODE: true
  LENS2_DEV_MODE_PLAYGROUND: false
  LENS2_REFRESH_WORKER: true
  LENS2_SCHEMA_PATH: model
  LENS2_PG_SQL_PORT: 5432
  CACHE_DATA_DIR: "/var/work/.store"

  services:
  api:
  restart: always
  image: rubiklabs/lens2:0.35.55-01 
  ports:
    - 4000:4000
    - 25432:5432
    - 13306:13306
  environment:
  <<: *lens2-environment

  volumes:
  - ./model:/etc/dataos/work/model
  ```
</Accordion>

## Configure the docker-compose manifest file

Configure theÂ `docker-compose.yml`Â manifest file to tailor it to include environment-URL, lens meta info, and, source details as per requirement:

* **Adjust the environment URL according to preferences.**

```yaml
DATAOS_FQDN: emerging-hawk.dataos.app #add the URL for the environment you prefer to use.
```

* **Update Lens meta info, including name, description, tags, and author details.**

```yaml
# Overview
LENS2_NAME: lens_name 
LENS2_DESCRIPTION: "Purpose of the lens"
LENS2_TAGS: "lens2, ecom, sales and customer insights" #add tags for better discoverability
LENS2_AUTHORS: "author_name" #add the owner name here
LENS2_SCHEDULED_REFRESH_TIMEZONES: "UTC,America/Vancouver,America/Toronto"
```

* **Customize the source details:**

> Ensure access to the compute of the source. This needs to be verified at the source end.

**Data Source attributes for connecting via depot:**

To connect via the Depot, refer to the provided environmental variables in the syntax below.

```yaml
# Data Source
# This defines env variables for connecting to the source via the depot
LENS2_SOURCE_TYPE: depot
LENS2_SOURCE_NAME: depot_name #add the name of the depot 
DATAOS_RUN_AS_APIKEY: ****** # Add the user API Key for the env
```

**Data Source attributes to connect via Minerva or Themis Cluster:**

To connect via the Cluster, refer to the provided environmental variables in the syntax below.

```
# Data Source
# This defines env variables for connecting to the source via the cluster
LENS2_SOURCE_TYPE: minerva #If you want to connect via Themis, change the source type to Themis 
LENS2_SOURCE_NAME: cluster_name #add the cluster name
LENS2_SOURCE_CATALOG_NAME: catalog_name #add the catalog name
DATAOS_RUN_AS_APIKEY: ******
```

When connecting with different sources, refer to theÂ [data source guide](/resources/lens/data_sources/)Â for various sources, as each may need its specific settings.

* **Verify Service configuration:**Â In the service configuration, the image attribute specifies the container image to be used. Ensure that the image tag is up to date or matches the version pulled during the prerequisite setup.

To know more about the configurations of the docker-compose click [here](/resources/lens/docker_compose_attribute/)

## Testing Lens in the development environment

Before running ensure that the working directory is the Lens project directory and that the API key is correctly configured as specified in theÂ `docker-compose.yml`Â file.

Lens can be tested in the development environment by running the following command:

<CodeGroup>
  ```bash Command
  docker-compose up  #run docker-compose up command in terminal
  ```

  ```bash Output
  lens2-api-1  | Loaded  /app/scripts/config.js
  lens2-api-1  | ðŸ”¥ Table Store (0.35.55-01 ) is assigned to 3030 port.
  lens2-api-1  | ðŸ”— Lens2 SQL Service (PostgreSQL) is listening on 0.0.0.0:5432
  lens2-api-1  | ðŸš€ Lens2 API server (0.35.55-01 ) is listening on 4000
  ```
</CodeGroup>

The above-given output indicates that the Lens server has successfully started locally.

<Info>
  To quickly get started with testing Lens locally, follow theÂ [quick guide on testing your Lens model locally](https://dataos.info/quick_guides/test_data_model/). This guide provides a step-by-step approach to validating your SQL queries within the semantic model and ensures that tables and joins work as expected before deploying them to DataOS.
</Info>

## Exploring Lens in development environment

<Info>
  To quickly get started with testing Lens locally, follow theÂ [quick guide on testing your Lens model locally](https://dataos.info/quick_guides/test_data_model/). This guide provides a step-by-step approach to validating your SQL queries within the semantic model and ensures that tables and joins work as expected before deploying them to DataOS.
</Info>

Now that Lens model is successfully running without errors using docker-compose, one can begin exploring it using SQL APIs, REST APIs, or GraphQL APIs. This setup allows to thoroughly test Lens before proceeding to deployment, ensuring all functionalities are working as expected.

Before using APIS to explore a Lens, the Lens name needs to be retrieved, verify the name of the Lens in theÂ `docker-compose.yml`Â file. Additionally, ensure that the docker-compose is running in the background, as failing to do so may result in the following error:

```bash
psql: error: connection to server at "localhost" (127.0.0.1), port 25432 failed: Connection refused
```

**via SQL API**

Lens exposes a PostgreSQL-compatible interface, to query Lens tables and views using standard PostgreSQL syntax.

To interact with Lens through PostgreSQL, the following options are available:

* **PostgreSQL client (psql):**Â This command-line tool allows direct interaction with PostgreSQL database. Use psql to run queries, manage databases, and perform various administrative tasks. Ensure postgres-client-16 is installed.

* **VS Code extension:**Â Use the PostgreSQL Client extension for Visual Studio Code. This extension enables SQL query execution and database management within VS Code.

**Using PostgreSQL client (psql)**

Enter the hostname asÂ `localhost`, port as given in the service of theÂ `docker-compose.yml`Â and the name of the Lens and its workspace inÂ `lens:${workspace_name}:${lens_name}`Â format.

<Tip>
  Always refer to 'ports' within the services section inÂ `docker-compose.yml`Â for the exposed port.
</Tip>

```bash
psql -h ${host_name} -p ${port_name} -U${user_name} -d ${lens:<workspace-name>:<lens-name>}
```

For local testing, set the host as the localhost:

```bash
psql localhost -p 6432 -U iamgroot -d lens:curriculum:product-analysis
```

When prompted, enter the DataOS API Key as the password.

The connection is successful. Verify the connection by listing the available relations using theÂ `\dt`Â command:

```bash
iamgroot=> \dt
```

To exitÂ `psql`, type:

```bash
iamgroot=> \q
```

To know about how to explore the deployed Lens using SQL API, clickÂ [here](/resources/lens/exploration_of_deployed_lens_using_sql_apis/).

**Using VS Code Extension:**

Use the following details to connect to the Postgresql interface using VS Code extension:

* Install the PostgreSQL Client extension.

* Click the 'Create Connection' button on the left side panel.

* Configure the connection with the following details and click '+connect':

| POSTGRES PROPERTY | DESCRIPTION         | EXAMPLE                      |
| ----------------- | ------------------- | ---------------------------- |
| Host              | Host name           | localhost                    |
| Port              | Port number         | 25432                        |
| Database          | Database name       | postgres                     |
| Username          | DataOS username     | postgres or iamgroot         |
| Password          | DataOS user API key | dskhcknskhknsmdnalklquajzZr= |

* Once connected, hover over the Postgres folder and click the terminal icon to open the terminal for querying.

* Execute the necessary commands and queries in the terminal as needed. For example, to list all the tables in the connected database (Lens semantic model), use the following command:

```bash
postgres=> \dt #listing all the tables in the connected database.

#Expected_output
 Schema |         Name         | Type  |  Owner   
--------+----------------------+-------+----------
 public | channel              | table | postgres
 public | customer             | table | postgres
 public | product_analysis     | table | postgres
 public | products             | table | postgres
 public | transaction_analysis | table | postgres
 public | transactions         | table | postgres
(6 rows)
```

**Here are some more commands for reference**

| Command                                         | Description       | Command Example      |
| ----------------------------------------------- | ----------------- | -------------------- |
| Show the schema and details of a specific table | `\d [table_name]` | E.g., `\d customers` |
| List all databases in the PostgreSQL server     | `\l`              |                      |
| List all roles and users                        | `\du`             |                      |
| List all schemas in the database                | `\dn`             |                      |
| List all views in the connected database        | `\dv`             |                      |
| Exit the PostgreSQL prompt                      | `\q`              |                      |

### **via REST API**

To interact with REST APIs use tools likeÂ `curl`,Â [Postman](https://www.postman.com/).

For instance, to test Lens in a development environment using Postman, upload the following API collection to Postman.

[Lens2-API](/resources/lens/lens_model_folder_setup/Lens2-APIs.postman_collection.json)

Now, to make a basicÂ `GET`Â request using Postman, follow these steps:

**Create a new request**: Open Postman and click on theÂ **New**Â button in the top left corner. SelectÂ **Request**Â from the dropdown menu.

**Configure the request**:

1. **Enter request name**: Provide a name for the request.

2. **Select collection**: Choose the uploaded collection.

**Set the HTTPS method**: In the request tab, selectÂ `GET`Â from the dropdown menu next to the URL input field.

**Ensure the following header is passed in Authorization when running the API**

```bash
Type: Bearer Token
Token: <DATAOS API Key> #Use the API key of the env defined in docker-compose.yml
```

**Enter the request URL**: Enter the full URL for the API endpoint you want to access. For example:

```bash
http://localhost:8080/lens2/api/${lens_name}`/v2/meta  
```

**Command parameter**

* `localhost:8080`Â represents the local or development environment for Lens, used for building and testing configurations.

* `/lens2/api/`Â is the API prefix.

* `${lens_name}`Â is the placeholder for Lens, replace it with the actual Lens undergoing testing. For example, sales360, retail360.

* After configuring the URL with appropriate parameters the URL will be as follows:

```
http://localhost:8080/lens2/api/curriculum:sales-analysis/v2/meta  
```

ClickÂ **Send**

**Example response:**

```json
{
  "name": "",
  "description": [],
  "authors": [],
  "devMode": true,
  "source": {
    "type": "minerva"
  },
  "timeZones": ["UTC"],
  "tables": [
    {
      "name": "product_analysis",
      "type": "view",
      "title": "Product Analysis"
    }
  ]
}        
```

*You can now successfully test your Lens in a development environment using Postman via REST APIS.*

To interact with the deployed Lens using REST APIs read the detailed docÂ [here](/resources/lens/exploration_of_deployed_lens_using_rest_apis/)
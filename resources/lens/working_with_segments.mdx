---
title: "Working with segments"
---

<Info>
  To get started with segments, refer to this quick guide on working with segments. This guide will help in defining and applying segments in Lens that can be used during analysis. With segments, users can save time and make complex filtering logic reusable.
</Info>

## When to use segments?

* **Complex filtering logic**: Segments are ideal for defining complex filtering logic in SQL that can be reused across multiple queries.

* **Reusability**: When you observe the reuse of common filters across various queries. Where the value of the filter doesn’t vary much.

## How to define segments?

Segments are pre-defined groups of filters. It provides the ability to define Segments (filters) as code within the Lens YAML. They can be used to define repetitively used groups of filters by the stakeholders. Segments are defined within a Lens table’s schema. Utilize the **`sql`** parameter to define how a segment filters out a subset of data, ensuring the SQL expression is valid within a **`WHERE`** statement. For example, users for one particular city can be treated as a segment

```sql
  tables:
    - name: customers
      sql: {{ load_sql('customers') }}
      description: "This table captures detailed customer information"
      public: true
      dimensions:   
        - name: country
          type: string
          column: country
          description: "The country where the customer resides, providing geographic segmentation and analysis opportunities."

       #...
       
      segments:
        - name: common_state
          sql: "{TABLE}.state = 'Illinois'"
```

* This is the segment definition for customers located in **Illinois**. It can be reused in queries instead of repeatedly writing `WHERE {TABLE}.state = 'Illinois'`.

* Use ‘OR’ to define a filter involving multiple columns. An example segment declaration to create a group of commonly used state filters:

```yaml
segments:
  name: common\_state
  sql: "{TABLE}.state = 'Illinois' or {TABLE}.state = 'Ohio'"
```

Consider the above segment equivalent to the following `WHERE` clause.

```sql
WHERE Country = 'Illinois' OR Country = 'Ohio';
```

* You can leverage filtering keywords such as `LIKE` to define filtering criteria. For example to segment customer records based on the condition that the `state` is either **Illinois** or contains the word **Ohio** (such as "Ohio", "New Ohio", etc.).

```yaml
  segments:
    - name: common_state
      sql: "{TABLE}.state = 'Illinois' or {TABLE}.state like '%Ohio%'"
```

The above segment would be equivalent to the following SQL `WHERE` clause.

```sql
WHERE state = 'Illinois' OR state LIKE '%Ohio%'
```

* You can combine logical operators like `OR` and `AND` to create dynamic criteria for segments. This is useful when you need to apply filters to more than one column.Below example filters records from the `Customers` table where the `Country` is **Spain**, and the `CustomerName` starts with either "G" or "R".

```yaml
  segments: # Defining row filter policy on Segment
    name: spain\_and\_customer\_name
    sql: "{TABLE}.Country = 'Spain' AND ({TABLE}.CustomerName LIKE 'G%' OR {TABLE}.CustomerName LIKE 'R%')"
```

Data policies can be defined directly on segments to enforce data governance and compliance. This ensures that access and interaction with different subsets of data are managed effectively. It applies a row filter data policy to show specific data based on user groups.Let's demonstrate an example by adding the filter policy to the `segments` section of a table definition:

**Example:** Filtering rows to show online sales data to `type-analyst` user groups and hide `reader` user groups.

```yaml
table:

#...

segments:

  name: online\_sales
  sql: "{TABLE}.order\_mode = 'online'"
  meta:
    secure:
  user_groups:
  includes:
    - reader
  excludes:
    - type-analyst
```
---
title: Best practices for efficient query processing in DataOS
description: To ensure optimal performance and efficiency when designing data solutions, it is recommended to pre-aggregate physical tables before modeling. The choice of where to perform this aggregation—whether on a lakehouse or a data warehouse—depends on the intended architecture and performance goals.
---


## Recommended practices

### 1. Pre-Aggregating physical tables before modeling (Lakehouse-Centric Approach)

If the data resides in a Azure Blob and BigQuery, it is recommended to create aggregated physical tables before modeling. In this approach:

* Flash serves as the query processing layer, enabling faster data retrieval.
* The semantic model (Lens) is built with Flash as the primary source.
* This approach optimizes query performance by minimizing redundant computations.

![Valid Scene 1](/resources/lens/best_practices_for_solution_designing/valid_scene_1.png)


### 2. Pre-Aggregating physical tables before modeling (Warehouse-Centric Approach)

If the user prefers to perform aggregation at the data warehouse level, such as BigQuery, Snowflake, or Redshift, the workflow follows these principles:

* Aggregation occurs within the warehouse before modeling.
* The warehouse engine handles query optimization and execution.
* This approach is well-suited for structured data processing and analytical workloads.


![Valid Scene 2](/resources/lens/images/valid_scene_2.png)

### 3. Using federation enginess Selectively (Exploration-Only Scenarios)

When working with data across multiple sources, federation engines can be useful, but their role should be carefully considered:

* Use federation engines only for data exploration and experimentation.
* Avoid using them for data activation, as they may not consistently meet performance SLOs.
* Directly querying the source system or using Flash for in-memory processing is often a more efficient alternative.

![Valid Scene 3](/resources/lens/images/valid_scene_3.png)


## Practices to avoid

### 1. Using a federation engines on top of a warehouse query engines

Avoid layering federation engines on top of BigQuery, Snowflake, or Redshift. While technically viable, this approach diverges from best practices for the following reasons:

* Unnecessary Cost Overhead: Engaging multiple query engines where a single engine is sufficient leads to redundant computational expenses.
* Performance Degradation: Introducing an additional processing layer increases query latency and resource consumption, diminishing overall system efficiency.

![Invalid scene 1](/resources/lens/images/invalid_scene_1.png)

### 2. Using federation engines for single-source queries

Avoid utilizing a federation engine when querying data from a single source, as this design, while functional, is suboptimal. Flash is better suited to efficiently handle such use cases compared to Minerva or Themis.

![Invalid scene 1](/resources/lens/images/invalid_scene_2.png)


### 3. Using Flash when the source system’s query engine suffices

Avoid using Flash when the native query engine of the source system can be leveraged. While technically viable, employing both Big Query and Flash in such scenarios introduces redundancy, particularly when caching or data duplication is not required. This principle also applies to Snowflake, Redshift, and similar data warehouses.

![Invalid scene 1](/resources/lens/images/invalid_scene_3.png)


---
title: "Observe and monitor a semantic model or Lens"
description: "Utilize different observability and monitoring tools in DataOS such as Operations app, Report Monitor, Equation Monitor, etc., to observe and monitor the semantic model or Lens Resource. "
sidebarTitle: "Metric monitoring"
---

Monitoring in Lens operates at three levels, each focusing on different aspects of system performance and reliability.

1. [Metric monitoring](/resources/lens/observability#metric-monitoring)

2. [Operational monitoring](/resources/lens/observability#operational-monitoring)

3. [Infrastructure monitoring](/resources/lens/observability#infrastructure-monitoring)

## Metric monitoring

Metric monitoring in Lens focuses on tracking the performance and health of the Lens Resources. It helps in measuring key indicators that define the state of the system. A Lens Resource can be monitored using Monitor and Pager Resources. There are two types of monitor that can be applied to observe the state of Lens and the matrix of the semantic model.

* [Equation monitor](/resources/lens/observability#metric-monitor)

* [Report monitor](/resources/lens/observability#report-monitor)

### Equation monitor

Equation Monitor can observe the Lens metrics to generate the incidents when the condition meet.

**Configuring Equation Monitor**

The following configuration sets up a monitor that runs every 2 minutes to evaluate whether the total number of customers of the `productaffinity` semantic model is less than `50`. It retrieves this value from the `total_customers` column in the `customer` table and checks if it meets the condition defined by the equation monitor. If the condition is met, an informational-level incident (`lens-customer-analysis`) is triggered.

```yaml
name: monitor-lens-metric-testing
version: v1alpha
type: monitor
runAsUser: iamgroot
monitor:
  schedule: '*/2 * * * *'
  type: equation_monitor
  equation:
    leftExpression:
      queryCoefficient: 1
      queryConstant: 0
      query:
        type: lens
        lens:
          dataOsInstance:
            name: productaffinity
            workspace: public
            sslmode: 'disable'
        ql: SELECT total_customers FROM customer where total_customers is not null and total_customers != 0
        comparisonColumn: {
            name: total_customers,
            dataType: int64
        }
    rightExpression:
      queryCoefficient: 0
      queryConstant: 50
      query:
    operator: not_equals
  incident:
    type: business-metric
    name: lens-customer-analysis
    category: equation
    severity: info
```

Deploy the Equation Monitor using the following `apply` command.

<CodeGroup>
  ```javascript Command
  dataos-ctl resource apply {monitor-manifest-file-path}
  ```
</CodeGroup>



Command to get the status of the monitor

<CodeGroup>
  ```javascript Command
  dataos-ctl get runtime -t monitor -w <WORKSPACE_NAME> -n <MONITOR_NAME>
  ```

  ```bash Example
  #Example_command
  dataos-ctl get runtime -t monitor -w curriculum -n monitor-lens-metric-testing

  #Expected Output
  INFO[0000] üîç monitor...                                 
  INFO[0002] üîç monitor...complete                         

               NAME             | VERSION |  TYPE   | WORKSPACE |     OWNER       
  ------------------------------|---------|---------|-----------|-----------------
    monitor-lens-metric-testing | v1alpha | monitor | public    | aayushisolanki  


    STATUS |            RUNTIME              
  ---------|---------------------------------
    active | next:2025-02-06T15:08:00+05:30  


       RUN ID    |          STARTED          |         FINISHED          | RUN STATUS |                                                     RESULT                                                      
  ---------------|---------------------------|---------------------------|------------|-----------------------------------------------------------------------------------------------------------------
    ec8fw0tupjb4 | 2025-02-06T15:06:00+05:30 | 2025-02-06T15:06:00+05:30 | completed  | üü© monitor condition met for monitor: 'monitor_lens_metric_testing_public', created incident id 'ec8fw1a81kw0'  
  ---------------|---------------------------|---------------------------|------------|-----------------------------------------------------------------------------------------------------------------
    ec8fpllx2ltt | 2025-02-06T15:04:00+05:30 | 2025-02-06T15:04:00+05:30 | completed  | üü© monitor condition met for monitor: 'monitor_lens_metric_testing_public', created incident id 'ec8fpm3ed0xt'  
  ---------------|---------------------------|---------------------------|------------|-----------------------------------------------------------------------------------------------------------------

  ```
</CodeGroup>

### Equation Monitor Pager

The following configuration defines a Pager Resource named `lens-equation-monitoring-pager` used for sending alerts to a Microsoft Teams channel when specific conditions related to a Lens Resource are met. The pager monitors the `lens-customer-analysis` incident, and when it is triggered, the configured alert is sent.

```yaml
name: lens-equation-monitoring-pager
version: v1alpha
type: pager
tags:
  - dataos:type:resource
  - service-failed-pager
description: This is for sending Alerts on Microsoft Teams Channel.
workspace: public
pager:
  conditions:
    - valueJqFilter: .properties.name
      operator: equals
      value: lens-customer-analysis

  output:
    webHook:
      url: "https://rubikdatasolutions.webhook.office.com/webhookb2/09239cd8-92a8-4d59-9621-9217305bf6ed@2e22bdde-3ec2-43f5-bf92-78e9f35a44fb/IncomingWebhook/0df05b99cc6300c898613/83e4eb41-6095-44d5-b0ba-8da9829e9cff/V2vWPDZYPw0zH-96mHWOn--hQyWI7h41"
      verb: post
      headers:
        'content-type': 'application/json'
      bodyTemplate: |
          {
            "@type": "MessageCard",
            "summary": "Total customers are low.",
            "themeColor": "0076D7",
            "sections": [
              {
                "activityTitle": "Dear Team",
                "activitySubtitle": "Our system detected that the total customer of a high demand product is low-replenish-rate."
              }
            ]
          }

```

**Expected Output**&#x20;

The above pager raised the incident as shown in the below image:

![](/image.png)

### Report Monitor

The **Report Monitor** is designed to monitor and match string values, such as the status or runtime of a DataOS resource. It leverages the DataOS API to retrieve real-time data, providing visibility into the operational state and performance of resources. This tool is particularly useful for tracking the ongoing status of resources and ensuring that they operate as expected within the system.

The following section outlines the steps to create a Report Monitor Resource that triggers an incident when the state of a Lens changes from 'active' to 'deleted'. Before proceeding, ensure you have the necessary permissions to create a Monitor Resource.&#x20;

<Steps>
  <Step title="Create a Report Monitor to observe the semantic model">
    Begin by creating a manifest file of Monitor Resource as shown in the template below.  Copy the template and replace the Lens name with your actual Lens name.

    ```
    # Resource meta section
    name: lens-status-monitor
    version: v1alpha
    type: monitor
    tags:
      - dataos:type:resource
      - dataos:layer:user
    description: Attention! Lens is deleted
    layer: user
    monitor:

    # Monitor-specific section
      schedule: '*/2 * * * *'
      incident:
        name: lens
        severity: high
        incidentType: lens
        
      type: report_monitor
    # Report Monitor specification
      report:
        source:
          dataOsInstance:
             path: /collated/api/v1/reports/resources/status?id=lens:v1alpha:<LENS_NAME>
        conditions:
          - valueComparison:
              observationType: state
              valueJqFilter: '.value'
              operator: equals
              value: deleted
    ```
  </Step>

  <Step title="Validate the  DataOS instance API path ">
    Before applying the Monitor Resource file, it is recommended to verify the response of the API endpoint using an API testing application like Postman. Add the following URL with `GET` request to test.

    ```
    https://<DATAOS-FQDN>/collated/api/v1/reports/resources/status?id=lens:v1alpha:<LENS_NAME>:<WORKSPACE_NAME>
    ```

    Make sure to replace the `<LENS_NAME>` and `<WORKSPACE_NAME>` placeholders with the name

    ![](/image.png)

    A status code of 200 indicates that you can proceed further.
  </Step>

  <Step title="Apply the Monitor manifest file">
    After validating the API endpoint, the next step is to apply the Monitor manifest file by executing the code below.

    ```bash
    dataos-ctl resource apply -f ${{path-of-your-manifest-file}}
    ```
  </Step>

  <Step title="Validate the Monitor">
    Validate or check the runtime of the Monitor by executing the below command.

    <CodeGroup>
      ```javascript Command
      dataos-ctl get runtime -t monitor -w curriculum -n <MONITOR_NAME> -r 

      ```

      ```
      dataos-ctl get runtime -t monitor -w curriculum -n s-monitor1 -r         
      INFO[0000] üîç monitor...                                 
      INFO[0000] üîç monitor...complete                         

              NAME       | VERSION |  TYPE   | WORKSPACE |    OWNER     
      -------------------|---------|---------|-----------|--------------
        runtime-monitor1 | v1alpha | monitor | curriculum    | iamgroot  

              NAME       | VERSION |  TYPE   | WORKSPACE |    OWNER     
      -------------------|---------|---------|-----------|--------------
        runtime-monitor1 | v1alpha | monitor | curriculum    | iamgroot  


        STATUS |            RUNTIME              
      ---------|---------------------------------
        active | next:2025-01-28T18:38:00+05:30  


           RUN ID    |          STARTED          |         FINISHED          | RUN STATUS |                                                                     RESULT                                                                      
      ---------------|---------------------------|---------------------------|------------|-------------------------------------------------------------------------------------------------------------------------------------------------
        ebctzh4krmro | 2025-01-28T18:30:00+05:30 | 2025-01-28T18:30:00+05:30 | completed  | üüß monitor condition not met for monitor: 'lens_monitor_curriculum'  
      ---------------|---------------------------|---------------------------|------------|----------------------------------------------------------------------
        ebctt1wkmsxv | 2025-01-28T18:28:00+05:30 | 2025-01-28T18:28:00+05:30 | completed  | üüß monitor condition not met for monitor: 'lens_monitor_curriculum'  
      ---------------|---------------------------|---------------------------|------------|----------------------------------------------------------------------
        ebctmmokhz42 | 2025-01-28T18:26:00+05:30 | 2025-01-28T18:26:00+05:30 | completed  | üüß monitor condition not met for monitor: 'lens_monitor_curriculum'  
      ---------------|---------------------------|---------------------------|------------|----------------------------------------------------------------------
        ebcuiqs8omis | 2025-01-28T18:36:00+05:30 | 2025-01-28T18:36:00+05:30 | completed  | üü© monitor condition met for monitor: 'lens_monitor_curriculum', 'lens:v1:productaffinity', created incident id 'abuird1u680'  
      ---------------|---------------------------|---------------------------|------------|-------------------------------------------------------------------------------------------------------------------------------------------------

      ```
    </CodeGroup>
  </Step>
</Steps>

## Create a Pager Resource to get notified when a Lens is deleted

A Pager Resource is used to send notifications when specific conditions are met. In this case, a Monitor Resource detects when an Instance Secret is deleted and triggers an incident. The Pager Resource then ensures that the incident notification is sent to a designated platform, such as Microsoft Teams, Outlook, or other supported output sources.

This section outlines the steps to create a Pager Resource. While we are using Microsoft Teams for notifications in this guide, you can configure other supported platforms based on your requirements.

<Steps>
  <Step title="Create a Pager manifest file">
    Begin by creating a manifest file that defines the Pager configurations, as shown in the template below. Replace the provided values with your actual values and modify the notification template as needed.

    ```

    name: lensmonitoringpager
    version: v1alpha
    type: pager
    tags:
      - dataos:type:resource
      - service-failed-pager
    description: This is for sending Alerts on Microsoft Teams Channel.
    workspace: public
    pager:
      conditions:
        - valueJqFilter: .properties.name
          operator: equals
          value: lensmonitoring

      output:
        webHook:
          url: https://rubikdatasolutions.webhook.office.com/webhookb2/e6b48e18-bdb1-4ffc-98d5-cf4a3890lkh4@2e22bdde-3ec2-43f5-bf92-78e9f35a44fb/IncomingWebhook/d23792bec444445gg8bb7193145dfae985/631bd149-c89d-4d3b-8979-8e364f62b419/V2ZJfUrl5d8I5xPhM80JyeE9LqKHU53gPsJQX9H8I2fOs1
          verb: post
          headers:
            'content-type': 'application/json'
          bodyTemplate: |
              {
                "@type": "MessageCard",
                "summary": "Lens is active",
                "themeColor": "0076D7",
                "sections": [
                  {
                    "activityTitle": "Dear Team,",
                    "activitySubtitle": "Lens is active",
                    "activityImage": "https://adaptivecards.io/content/cats/3.png",
                    "facts": [
                      {
                        "name": "Following Lens is active",
                        "value": "{{ index (splitn ":" 4 .ReportContext.ResourceId) "_2" }}"
                      },
                      {
                        "name": "Failure Time:",
                        "value": "{{ .CreateTime }}"
                      },
                      {
                        "name": "Severity:",
                        "value": "{{ .Properties.severity }}"
                      },
                      {
                        "name": "Run Details:",
                        "value": "<a href=\"https://${dataos-fqdn}/operations/user-space/resources/resource-runtime?name={{ index (splitn ":" 4 .ReportContext.ResourceId) "_2" }}&type=lens&workspace=public\">Operation</a>"
                      },
                      {
                        "name": "Logs:",
                        "value": "<a href=\"https://${dataos-fqdn}/metis/resources/lens/dataos.public.{{ index (splitn ":" 4 .ReportContext.ResourceId) "_2" }}/run_history\">Metis</a>"
                      }
                    ]
                  },
                  {
                    "title": "Disclaimer",
                    "text": "{{ .Monitor.Description }}"
                  }
                ]
              }
    ```
  </Step>

  <Step title="Apply the manifest file ">
    Apply the manifest file for Pager Resource using following command in your terminal:

    ```
    dataos-ctl resource apply -f ${{path-of-your-manifest-file}}
    ```
  </Step>
</Steps>

## Operational monitoring

The operational mo

To monitor the Lens  using the Operations app follow the below steps:

<Steps>
  <Step title="Go to DataOS ">
    Navigate to the DataOS home page.  Click on the 'Operations' app.

    ![](/Operations_app)
  </Step>

  <Step title="Search Lens">
    When you click on the Operations app, it launches with the User Space displayed by default.  The Resources tab in the User Space contains the log level information of the  resources that DataOS users can create and manage within the platform.

    Here, search the name of your Lens the search result will have Lens Resource and it's behind the scenes running services.&#x20;

    ![](/Screenshotfrom2025-02-0418-44-13.png)
  </Step>
</Steps>

### Check Query Stats for Minerva

To check the query statistics, please follow the steps below:

<Steps>
  <Step title="Open the Operations app" titleSize="h2">
    By default, the **User Space** tab is displayed upon accessing the Operations app. In User Space click on the 'Minerva Queries' tab to view query execution details.

    Set the following filters:

    * Source: `lens2`

    * Dialect: `trino_sql`

    Optionally, refine your results by filtering based on **Cluster**, **Username**, or other available criteria as needed.

    ![](https://mintlify.s3-us-west-1.amazonaws.com/dataosinfo/resources/lens/data_sources/minerva/Untitled1.png)
  </Step>

  <Step title="Select the query id" titleSize="h2">
    Identify and choose the **Query ID** of interest from the **Minerva Queries** tab. Once selected, the system will display detailed execution statistics, providing insights into performance, execution time, and resource utilization.
  </Step>
</Steps>

### Check query statistics for AWSRedshift

<Note>
  Ensure the user has AWS console access before proceeding.
</Note>

<Steps>
  <Step title="Log in to AWS Console " titleSize="h2">
    Login to the AWS Console and search for ‚ÄòRedshift‚Äô in the AWS Console search bar to access the Redshift.

    ![](https://mintlify.s3.us-west-1.amazonaws.com/dataosinfo/resources/lens/data_sources/awsredshift/Untitled1.png)
  </Step>

  <Step title="Select Redshift Cluster" titleSize="h2">
    Click on ‚ÄòAmazon Redshift‚Äô from the search results. You will be directed to the Redshift dashboard. Select the appropriate region and choose the desired cluster name from the list.

    ![](https://mintlify.s3.us-west-1.amazonaws.com/dataosinfo/resources/lens/data_sources/awsredshift/Untitled2.png)
  </Step>

  <Step title="Access Query Monitoring" titleSize="h2">
    Select the cluster you want to monitor. Navigate to the ‚ÄòQuery monitoring‚Äô tab to view query statistics.

    ![](https://mintlify.s3.us-west-1.amazonaws.com/dataosinfo/resources/lens/data_sources/awsredshift/Untitled3.png)
  </Step>

  <Step title="View running and completed queries" titleSize="h2">
    In the ‚ÄòQuery monitoring‚Äô tab, you will see a list of running and completed queries.&#x20;

    ![](https://mintlify.s3.us-west-1.amazonaws.com/dataosinfo/resources/lens/data_sources/awsredshift/Untitled4.png)
  </Step>

  <Step title="Monitor specific query" titleSize="h2">
    Click on the query you want to monitor and view the query statistics, as shown in the example below.

    ![](https://mintlify.s3.us-west-1.amazonaws.com/dataosinfo/resources/lens/data_sources/awsredshift/Untitled5.png)
  </Step>
</Steps>

### Check Query Stats for Themis

<Info>
  Please ensure you have the required permission to access the Operations.
</Info>

To check the query statistics, please follow the steps below:

1. **Access the Themis Cluster:** Navigate to the Themis cluster. You should see a screen similar to the image below:

2. **Select the Running Driver:** Choose the running driver. **This driver will always be the same, regardless of the user, as queries will be directed to the creator of the Themis cluster**. The running driver remains consistent for all users.

3. **View the Spark UI:** Go to terminal and use the following command to view the spark UI:

```yaml
dataos-ctl -t cluster -w public -n themislens --node themis-themislens-iamgroot-default-a650032d-ad6b-4668-b2d2-cd372579020a-driver view sparkui

dataos-ctl -t cluster -w public -n themis_cluster_name --node  driver_name view sparkui
```

You should see the following interface:

![](/resources/lens/data_sources/Themis/Untitled\(9\).png)
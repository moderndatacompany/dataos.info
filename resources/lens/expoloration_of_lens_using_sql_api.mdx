---
title: "Exploration of Lens using SQL API"
---

import CreateApiKey from '/snippets/create_api_key.mdx';

Lens exposes a PostgreSQL-compatible interface, enabling interaction with the semantic model(Lens) using PostgreSQL syntax. The PostgreSQL client tool `psql` is required to query the database and manage Lens data.

## Prerequisites

* **Active Lens:** To interact with the Lens, it must be active. If the Lens is deployed on DataOS, ensure it is properly set up.

* **DataOS API Key:**  DataOS API key can be generated using either of the following:

<Tabs>
  <Tab title="Using CLI">
    When prompted for a password, use the DataOS API Key as the password. To retrieve the API Key, run the following command in the terminal:

    ```
    dataos-ctl user apikey get

    #Expected Output

    TOKEN                  │  TYPE  │        EXPIRATION         │                   NAME                     
    ────────────────┼──────┼───────────────────────────┼────────────────────────────────────────────
    abcdefghijiklmnopqrstuvwxyz │ apikey │ 2024-12-06T05:30:00+05:30 │ token_urgently_generally_bursting_gobbler 
    ```

    If the API Key is not already available, create one using the following command:

    ```bash
    dataos-ctl user apikey create -n ${name-of-apikey} -i ${user-id} -d ${duration}
    ```

    For example, if the user name is iamgroot:

    ```
    dataos-ctl user apikey create -n test_api_key -i iamgroot -d 24h

    #Expected_Output
    INFO[0000] 🔑 user apikey...                             
    INFO[0003] 🔑 user apikey...complete                     

           TOKEN                │  TYPE  │        EXPIRATION         │     NAME      
    ───────────────────────────────────────────────────────────────────────┼────────┼───────────────────────────┼───────────────
    abcdefghijklmnopqrstuvwxyz== │ apikey │ 2024-11-29T12:30:00+05:30 │ test_api_key
    ```
  </Tab>

  <Tab title="Using GUI">
    When exploring the semantic model via Data Product Hub, you can easily generate an API key directly within the Data Product Hub. Below are the steps to create and view your API key:

    1. **Accessing profile settings:**

       * Navigate to the bottom-left corner of the Data Product Hub interface, where you will find your profile icon.

       * Click on the profile icon to reveal a message displaying your profile details.

       * Hover over the message and click on it to open the overview section of your profile.

    2. **Viewing or creating an API key:**

       * Within the overview section, click on the ‘Tokens’ tab.

       * By default, API keys are hidden. To reveal your existing API key, click the eye icon next to the key.

       * To copy the API key, simply click on the key.

    3. **Creating a new API Key:**

       * If an API key is not already listed, you can create a new one by clicking the `+ Add APIKey` button.

       * A dialog box will appear where you can name your API key and set an expiration duration for the key, either in hours or by specifying a specific end date.
  </Tab>
</Tabs>

## Exploration of Lens using SQL API

To interact with Lens through PostgreSQL, the following options are available:

* **Postgreql client (psql):** The `psql` command-line tool enables direct interaction with a PostgreSQL database. It is used to run queries, manage the database, and perform various administrative tasks. Ensure that postgresql-client-16 is installed. If it is not already installed, download and install postgresql-client-16 for your operating system using [this link](https://www.postgresql.org/download/).

* **VS Code extension:** Use the PostgreSQL Client extension for Visual Studio Code. This extension enables SQL query execution and database management within VS Code.

## Postgresql client (psql)

The `psql` command-line tool is required to interact with Lens through PostgreSQL. Specifically, `postgresql-client-16` must be installed, as this version includes the necessary tools to connect and query the database.

### **Retrieve Lens**

Before using SQL APIs to explore a Lens, the Lens needs to be retrieved from the workspace. If a user has created a Lens, he can verify its name in the `deployment.yml` file or retrieve it by running the following command:

<Tabs>
  <Tab title="Command">
    ```
    dataos-ctl resource get -t lens -w ${workspace} 
    ```
  </Tab>

  <Tab title="Example">
    ```
    # For a workspace named "curriculum", the command and its expected output are as follows:
    dataos-ctl resource get -t lens -w curriculum
    # Expected Output
    INFO[0000] 🔍 get...                                     
    INFO[0000] 🔍 get...complete                             

                NAME             | VERSION |  TYPE   | WORKSPACE  | STATUS |   RUNTIME   |     OWNER        
    -------------------------------|---------|---------|------------|--------|-------------|-------------------
            sales360              | v1      | cluster | curriculum | active | running:1   |     ironman
    ```
  </Tab>
</Tabs>

To explore the Lens created by someone else in a particular workspace use the following command:

<Tabs>
  <Tab title="Code">
    This command requires specifying the workspace name to filter the Lens accordingly.

    ```
    dataos-ctl resource get -t lens -w ${workspace} -a
    ```
  </Tab>

  <Tab title="Example">
    ```
    # For a workspace named "curriculum", the command and its expected output are as follows:
    dataos-ctl resource get -t lens -w curriculum -a
    # Expected Output
    INFO[0000] 🔍 get...                                     
    INFO[0000] 🔍 get...complete                             

                NAME             | VERSION |  TYPE   | WORKSPACE  | STATUS |   RUNTIME   |     OWNER        
    -------------------------------|---------|---------|------------|--------|-------------|-------------------
            c360-financial-service | v1      | cluster | curriculum | active | running:1   |     thor       
            sales360               | v1      | cluster | curriculum | active | running:1   |     ironman  
            Product360             | v1      | cluster | curriculum | active | running:2   |     thanos
    ```
  </Tab>

  ```bash
  # For a workspace named "curriculum", the command and its expected output are as follows:
  dataos-ctl resource get -t lens -w curriculum -a
  # Expected Output
  INFO[0000] 🔍 get...                                     
  INFO[0000] 🔍 get...complete                             

          NAME             | VERSION |  TYPE   | WORKSPACE  | STATUS |   RUNTIME   |     OWNER        
  -------------------------------|---------|---------|------------|--------|-------------|-------------------
      c360-financial-service | v1      | cluster | curriculum | active | running:1   |     thor       
      sales360               | v1      | cluster | curriculum | active | running:1   |     ironman  
      Product360             | v1      | cluster | curriculum | active | running:2   |     thanos
  ```
</Tabs>

After retrieving the name of the Lens, the following steps describe how to connect to it using the `psql` command.&#x20;

Open the terminal. Use the following command to connect to the Lens using `psql`:

<Tabs>
  <Tab title="Syntax">
    ```
    psql -h ${host_name} -p 6432 -U ${user-name} -d ${lens:<workspace-name>:<lens-name>} 

    ```
  </Tab>

  <Tab title="Example">
    ```bash
    psql -h tcp.liberal-monkey.dataos.app -p 6432 -U iamgroot -d lens:curriculum:product360
    ```
  </Tab>
</Tabs>

Replace with the appropriate context for the deployed Lens. For example, in `liberal-monkey.dataos.app`, the context is `liberal-monkey`. Additionally, replace the workspace name with the name of the actual workspace where Lens is deployed. For instance, `public`, `sandbox` etc.

When prompted, enter the DataOS API Key as the password.

The connection is successful. Verify the connection by listing the available relations using the `\dt` command:

```
iamgroot=> \dt
```

**Expected output**

```bash
Password for user iamgroot: 
psql (16.3 (Ubuntu 16.3-1.pgdg22.04+1), server 14.2 (Lens2/sales400 v0.35.41-01))
Type "help" for help.

iamgroot=> \dt
                List of relations
 Schema |          Name           | Type  |     Owner      
 --------+-------------------------+-------+----------------
 public | customer                | table | iamgroot
 public | customer_lifetime_Value | table | iamgroot
 public | product                 | table | iamgroot
 public | repeat_purchase_rate    | table | iamgroot
 public | sales                   | table | iamgroot
 public | stock_status            | table | iamgroot
 public | warehouse_inventory     | table | iamgroot
 (7 rows)
```

To exit `psql`, type:

```
iamgroot=> \q
```

## Postgresql VS Code extension

One can also use the PostgreSQL extension on VS Code. Use the following details to connect to the Postgresql interface:

1. Install the PostgreSQL Client extension.

2. Click the 'Create Connection' button on the left side panel.

3. Configure the connection with the following details and click '+connect':

| **POSTGRES PROPERTY** | **DESCRIPTION**    | **EXAMPLE**                    |
| --------------------- | ------------------ | ------------------------------ |
| Host                  | host name          | `localhost`                    |
| Port                  | port name          | `25432`                        |
| Database              | database name      | `postgres`                     |
| Username              | dataos-username    | `postgres` or `iamgroot`       |
| Password              | dataos-user-apikey | `dskhcknskhknsmdnalklquajzZr=` |

1. Once connected, hover over the postgres folder and click the terminal icon to open the terminal for querying.

2. Execute [commands](#commands) in the terminal as needed.

## Commands

Here are some more commands for reference.

| Command Description                             | Command Example                       |
| ----------------------------------------------- | ------------------------------------- |
| Show the schema and details of a specific table | `\d [table_name]` E.g.,`\d customers` |
| List all databases in the PostgreSQL server     | `\l`                                  |
| List all roles and users                        | `\du`                                 |
| List all schemas in the database                | `\dn`                                 |
| List all views in the connected database        | `\dv`                                 |
| Exit the PostgreSQL prompt                      | `\q`                                  |
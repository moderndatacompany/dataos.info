---
title: "AWS Redshift"
---

## Step 1: Create the AWS Redshift Depot

If the Depot is inactive, you must create one using the provided template.

```yaml
name: ${{redshift-depot-name}}
version: v2alpha
type: depot
tags:
- ${{redshift}}
layer: user
description: ${{Redshift Sample data}}
depot:
type: REDSHIFT
redshift:
  host: ${{hostname}}
  subprotocol: ${{subprotocol}}
  port: ${{5439}}
  database: ${{sample-database}}
  bucket: ${{tmdc-dataos}}
  relativePath: ${{development/redshift/data_02/}}
external: ${{true}}
secrets:
  - name: ${{redshift-instance-secret-name}}-r
    allkeys: true

  - name: ${{redshift-instance-secret-name}}-rw
    allkeys: true

```

## Step 2: Prepare the sematic model folder

In the Model folder, the semantic model will be defined, encompassing SQL mappings, logical tables, logical views, and user groups. Each subfolder contains specific files related to the Lens model. You can download the Lens template to quickly get started.

[lens template](https://dataosinfo.mintlify.app/resources/lens/lens_model_folder_setup/lens-project-template.zip)

## Step 1: Create the AWS Redshift Depot

If the Depot is inactive, you must create one using the provided template.

```yaml
name: ${{redshift-depot-name}}
version: v2alpha
type: depot
tags:
- ${{redshift}}
layer: user
description: ${{Redshift Sample data}}
depot:
type: REDSHIFT
redshift:
  host: ${{hostname}}
  subprotocol: ${{subprotocol}}
  port: ${{5439}}
  database: ${{sample-database}}
  bucket: ${{tmdc-dataos}}
  relativePath: ${{development/redshift/data_02/}}
external: ${{true}}
secrets:
  - name: ${{redshift-instance-secret-name}}-r
    allkeys: true

  - name: ${{redshift-instance-secret-name}}-rw
    allkeys: true
```

## Step 2: Prepare the sematic model folder

In the Model folder, the semantic model will be defined, encompassing SQL mappings, logical tables, logical views, and user groups. Each subfolder contains specific files related to the Lens model. You can download the Lens template to quickly get started.

[lens template](/resources/lens/lens_model_folder_setup/lens-project-template.zip)

<Steps>
  <Step title="Load data from the data source" titleSize="h2">
    In the `sqls` folder, create `.sql` files for each logical table, where each file is responsible for loading or selecting the relevant data from the source. Ensure that only the necessary columns are extracted, and the SQL dialect is specific to the data source.

    For example, a simple data load might look as follows:

    ```sql
    SELECT
      *
    FROM
      "onelakehouse"."retail".channel;
    ```

    Alternatively, you can write more advanced queries that include transformations, such as:

    ```sql
    SELECT
      CAST(customer_id AS VARCHAR) AS customer_id,
      first_name,
      CAST(DATE_PARSE(birth_date, '%d-%m-%Y') AS TIMESTAMP) AS birth_date,
      age,
      CAST(register_date AS TIMESTAMP) AS register_date,
      occupation,
      annual_income,
      city,
      state,
      country,
      zip_code
    FROM
      "onelakehouse"."retail".customer;
    ```
  </Step>

  <Step title="Define the table in the Model" titleSize="h2">
    Create a `tables` folder to store logical table definitions, with each table defined in a separate YAML file outlining its dimensions, measures, and segments. For example, to define a table for `sales `data:

    ```yaml
    table:
      - name: customers
        sql: {{ load_sql('customers') }}
        description: Table containing information about sales transactions.
    ```

    ### Add dimensions and measures

    After defining the base table, add the necessary dimensions and measures. For example, to create a table for sales data with measures and dimensions, the YAML definition could look as follows:

    ```yaml
    tables:
      - name: sales
        sql: {{ load_sql('sales') }}
        description: Table containing sales records with order details.

        dimensions:
          - name: order_id
            type: number
            description: Unique identifier for each order.
            sql: order_id
            primary_key: true
            public: true

        measures:
          - name: total_orders_count
            type: count
            sql: id
            description: Total number of orders.
    ```

    ### Add segments to filter

    Segments are filters that allow for the application of specific conditions to refine the data analysis. By defining segments, you can focus on particular subsets of data, ensuring that only the relevant records are included in your analysis. For example, to filter for records where the state is either Illinois or Ohio, you can define a segment as follows:

    ```yaml
    segments:
      - name: state_filter
        sql: "{TABLE}.state IN ('Illinois', 'Ohio')"
    ```

    To know more about segments click [here](https://dataos.info/resources/lens/working_with_segments/).
  </Step>

  <Step title="Create the Views" titleSize="h2">
    Create a **views** folder to store all logical views, with each view defined in a separate YAML file (e.g., `sample_view.yml`). Each view references dimensions, measures, and segments from multiple logical tables. For instance the following`customer_churn` view is created.

    ```yaml
    views:
      - name: customer_churn_prediction
        description: Contains customer churn information.
        tables:
          - join_path: marketing_campaign
            includes:
              - engagement_score
              - customer_id
          - join_path: customer
            includes:
              - country
              - customer_segments
    ```

    To know more about the views click [here](https://dataos.info/resources/lens/working_with_views/).
  </Step>

  <Step title="Create User groups" titleSize="h2">
    This YAML manifest file is used to manage access levels for the semantic model. It defines user groups that organize users based on their access privileges. In this file, you can create multiple groups and assign different users to each group, allowing you to control access to the model.By default, there is a 'default' user group in the YAML file that includes all users.

    ```yaml
    user_groups:
      - name: default
        description: this is default user group
        includes: "*"
    ```

    To know more about the User groups click [here](https://dataos.info/resources/lens/working_with_user_groups_and_data_policies/)
  </Step>
</Steps>

## Step 3: Deployment manifest file

Once the semantic model is prepared, create a `lens_deployment.yml` file parallel to the model folder.

```yaml
version: v1alpha
name: "redshiftlens"
layer: user
type: lens
tags:
  - lens
description: redshiftlens deployment on lens2
lens:
  compute: runnable-default
  secrets:
    - name: bitbucket-cred
      allKeys: true
  source:
    type: depot # source type is depot here
    name: redshiftdepot # name of the redshift depot
  repo:
    url: https://bitbucket.org/tmdc/sample
    lensBaseDir: sample/lens/source/depot/redshift/model 
    # secretId: lens2_bitbucket_r
    syncFlags:
      - --ref=lens

  api:   # optional
    replicas: 1 # optional
    logLevel: info  # optional    
    resources: # optional
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 2000m
        memory: 2048Mi
  worker: # optional
    replicas: 2 # optional
    logLevel: debug  # optional
    resources: # optional
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 6000m
        memory: 6048Mi
  router: # optional
    logLevel: info  # optional
    resources: # optional
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 6000m
        memory: 6048Mi
  iris:
    logLevel: info  
    resources: # optional
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 6000m
        memory: 6048Mi
  metric:
    logLevel: info  # Logging level for the metric component
```

Each section of the YAML template defines key aspects of the Lens deployment. Below is a detailed explanation of its components:

* **Defining the Source:**

  * **`type`:**  The `type` attribute in the `source` section must be explicitly set to `depot`.

  * **`name`:** The `name` attribute in the `source` section should specify the name of the AWS Redshift Depot created.

* **Setting Up Compute and Secrets:**

  * Define the compute settings, such as which engine (e.g., `runnable-default`) will process the data.

  * Include any necessary secrets (e.g., credentials for Bitbucket or AWS) for secure access to data and repositories.

* **Defining Repository:**

  * **`url`** The `url` attribute in the repo section specifies the Git repository where the Lens model files are stored. For instance, if your repo name is lensTutorial then the repo `url` will be  [https://bitbucket.org/tmdc/lensTutorial](https://bitbucket.org/tmdc/lensTutorial)

  * **`lensBaseDir`:**  The `lensBaseDir` attribute refers to the directory in the repository containing the Lens model. Example: `sample/lens/source/depot/awsredshift/model`.

  * **`secretId`:**  The `secretId` attribute is used to access private repositories (e.g., Bitbucket, GitHub). It specifies the secret needed to authenticate and access the repository securely.

  * **`syncFlags`**:  Specifies additional flags to control repository synchronization. Example: `--ref=dev` specifies that the Lens model resides in the dev branch.

* **Configure API, Worker, and Metric Settings (Optional):** Set up replicas, logging levels, and resource allocations for APIs, workers, routers, and other components.

## Step 4: Apply the Lens deployment manifest file

After configuring the deployment file with the necessary settings and specifications, Deploy the Lens using the following `apply` command:

```
dataos-ctl apply -f {manifest-file-path}
```

##
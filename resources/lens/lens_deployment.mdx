---
title: "Lens Deployment"
---

<Tip>
  To quickly get started with Lens deployment follow the [quick guide on deploying your Lens model](/quick_guides/deploy_data_model/) to walk through the process. This guide ensures a smooth and secure deployment, helping you get your Lens Resource up and running quickly.
</Tip>

This document provides instructions for setting up Lens in the DataOS environment, importing an existing Lens project from a local machine, and utilizing version control tools such as Bitbucket or Git.

## Pre-requisites

Before initiating the deployment process, please ensure you have the following:

* A directory containing a Lens model.

* Access to a hosted code repository, such as **Bitbucket**, **GitHub**, **AWS CodeCommit**, etc.

* Operator-level access permission.

<Note>
  If you are new to setting the Lens model directory refer to the detailed doc [here](/resources/lens/lens_model_folder_setup/).
</Note>

## Deployment Process

Follow the steps below to deploy Lens on DataOS:

<Steps>
  <Step title="Push the Lens model directory to a code repository" stepNumber="1" titleSize="h2">
    First, push your Lens model directory to a hosted code repository. This can be done on hosted code repository like [Bitbucket](https://support.atlassian.com/bitbucket-cloud/docs/push-code-to-bitbucket/), [GitHub](https://docs.github.com/en/migrations/importing-source-code/using-the-command-line-to-import-source-code/adding-locally-hosted-code-to-github), [AWS CodeCommit](https://docs.aws.amazon.com/codecommit/latest/userguide/getting-started.html) etc.

    <Info>
      ¬†If your code repository is private, you will need to create¬†**Instance Secrets**¬†with your repository credentials for later use during deployment. Public code repositories do not require Step 2.
    </Info>
  </Step>

  <Step title="Create Instance Secrets for Code Repository Credentials" titleSize="h2">
    Define the Instance Secret Resource in a YAML file. Below is a template you can use for Bitbucket, substituting `${USERNAME}` and `${PASSWORD}` with your actual Bitbucket credentials:

    <CodeGroup>
      ```yaml Syntax
      # RESOURCE META SECTION
      name: ${bitbucket-r } # Secret Resource name (mandatory)
      version: v1 # Secret manifest version (mandatory)
      type: instance-secret # Type of Resource (mandatory)
      description: Bitbucket read secrets for code repository # Secret Resource description (optional)
      layer: user # DataOS Layer (optional)

      # INSTANCE SECRET-SPECIFIC SECTION
      instance-secret: 
        type: key-value # Type of Instance-secret (mandatory)
        acl: r # Access control list (mandatory)
        data: # Data (mandatory)
          GITSYNC_USERNAME: ${USERNAME}
          GITSYNC_PASSWORD: ${PASSWORD}
      ```

      ```yaml Example
      # RESOURCE META SECTION
      name: bitbucket-r # Secret Resource name (mandatory)
      version: v1 # Secret manifest version (mandatory)
      type: instance-secret # Type of Resource (mandatory)
      description: Bitbucket read secrets for code repository # Secret Resource description (optional)
      layer: user # DataOS Layer (optional)

      # INSTANCE SECRET-SPECIFIC SECTION
      instance-secret: 
        type: key-value # Type of Instance-secret (mandatory)
        acl: r # Access control list (mandatory)
        data: # Data (mandatory)
          GITSYNC_USERNAME: iamgroot
          GITSYNC_PASSWORD: <git_token>
      ```
    </CodeGroup>

    **Apply the Instance Secret manifest**

    Deploy the Instance Secret to DataOS using the `apply` command.

    <Note>
      When applying the manifest file for Instance-secret from CLI, make sure you don't specify Workspace as Instance Secrets are¬†[Instance-level Resource](https://dataos.info/resources/types/#instance-level-resources).
    </Note>

    The `apply` command is as follows:

    <CodeGroup>
      ```bash Syntax
      #Replace ${manifest-file-path} with the path to your YAML file.
      dataos-ctl apply -f ./lens/instance_secret.yml=
      ```

      ```bash Example
      dataos-ctl apply -f ./lens/instance_secret.yml
      # Expected output
      INFO[0000] üõ† apply...                                   
      INFO[0000] üîß applying bitbucket-r:v1:instance-secret... 
      INFO[0001] üîß applying bitbucket-r:v1:instance-secret...created 
      INFO[0001] üõ† apply...complete 
      ```
    </CodeGroup>

    <Note>
      ¬†Ensure that you remember the name of the created¬†**Instance secret**, as it will be used in the secrets attribute section of the Lens manifest file. This name is crucial for proper configuration and access within your Lens environment.
    </Note>
  </Step>

  <Step title="Create a Lens Resource manifest file" titleSize="h2">
    Begin by creating a manifest file that will hold the configuration details for your Lens Resource. The structure of the Lens manifest file is provided below.

    <Accordion title="Sample Lens manifest" defaultOpen={false}>
      ```
      # RESOURCE META SECTION
      name: sales360test # Lens Resource name (mandatory)
      version: v1alpha # Lens manifest version (mandatory)
      layer: user # DataOS Layer (optional)
      type: lens # Type of Resource (mandatory)
      tags: # Tags (optional)
      - lens
      description: sales360 lens deployment on DataOS # Lens Resource description (optional)

      # LENS-SPECIFIC SECTION
      lens:
        compute: runnable-default # Compute Resource that Lens should utilize (mandatory)
        secrets: # Referred Instance-secret configuration (**mandatory for private code repository, not required for public repository)
          - name: bitbucket-r # Referred Instance Secret name (mandatory)
            allKeys: true # All keys within the secret are required or not (optional)
      source: # Data Source configuration
        type: minerva # Source type 
        name: system # Source name
        catalog: icebase #in case of minerva or themis
      repo: # Lens
      #model code repository configuration (mandatory)
        url: https://bitbucket.org/iamgroot/lens # URL of repository containing the Lens model (mandatory)
        lensBaseDir: lens/sales360/model # Relative path of the Lens 'model' directory in repository (mandatory)
        syncFlags: # Additional flags used during synchronization, such as specific branch.
          - --ref=lens # Repository Branch 
      api: # API Instances configuration (optional)
        replicas: 1 # Number of API instance replicas (optional)
        logLevel: info  # Logging granularity (optional)
        resources: # CPU and memory configurations for API Instances (optional)
          requests:
          cpu: 100m
          memory: 256Mi
          limits:
          cpu: 2000m
          memory: 2048Mi
      worker: # Worker configuration (optional)
        replicas: 2 # Number of Worker replicas (optional)
        logLevel: info # Logging level (optional)
        resources: # CPU and memory configurations for Worker (optional)
          requests:
          cpu: 100m
          memory: 256Mi
          limits:
          cpu: 6000m
          memory: 6048Mi
      router: # Router configuration (optional)
        logLevel: info  # Level of log detail (optional)
        resources: # CPU and memory resource specifications for the router (optional)
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: 6000m
            memory: 6048Mi
      iris:
        logLevel: info
        resources: # CPU and memory resource specifications for the iris board (optional)
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: 6000m
            memory: 6048Mi
      ```
    </Accordion>

    The manifest file of a Lens can be broken down into two sections:

    1. Resource meta section

    2. Lens-specific section

    ### **Resource-meta Section**

    In DataOS, a Lens is categorized as a Resource type. The YAML configuration file for a Lens Resource includes a Resource meta section, which contains attributes shared among all Resource types.

    The following YAML excerpt illustrates the attributes specified within this section:

    <CodeGroup>
      ```yaml Syntax
      name: ${{resource_name}} # Name of the Resource (mandatory)
      version: v1alpha # Manifest version of the Resource (mandatory)
      type: lens # Type of Resource (mandatory)
      tags: # Tags for categorizing the Resource (optional)
        - ${{tag_example_1}} 
        - ${{tag_example_2}} 
      description: ${{resource_description}} # Description (optional)
      owner: ${{resource_owner}} # Owner of the Resource (optional, default value: user-id of user deploying the resource)
      layer: ${{resource_layer}} # DataOS Layer (optional, default value: user)
      lens: # lens-specific Section
        ${{Attributes of lens-specific Section}}
      ```

      ```yaml Example
      name: my-first-lens # Name of the Resource
      version: v1alpha # Manifest version of the Resource
      type: lens # Type of Resource
      tags: # Tags for categorizing the Resource
        - dataos:lens 
        - lens 
      description: Common attributes applicable to all DataOS Resources # Description
      owner: iamgroot # Owner of the Resource
      layer: user # DataOS Layer
      lens: 
        # .... 
      ```
    </CodeGroup>

    To configure a lens Resource, replace the values of `name`, `layer`, `tags`, `description`, and `owner` with appropriate values. For additional configuration information about the attributes of the Resource meta section, refer to the link: [Attributes of Resource meta section](/resources/manifest_attributes/).

    ### **Lens-specific section**

    A typical deployment of a Lens Resource includes the following components:

    | Section    | Description                                                                                                                                                                                                                                                                                                             |
    | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
    | **Source** | Defines the configuration of the data source for data processing and querying.                                                                                                                                                                                                                                          |
    | **Repo**   | Outlines the configuration of the code repository where the model used by Lens resides.                                                                                                                                                                                                                                 |
    | **API**    | Configures an API service that processes incoming requests, connecting to the database for raw data. A single instance is provisioned by default, but the system can auto-scale to add more instances based on workload demands, with a recommendation of one instance for every 5-10 requests per second.              |
    | **Worker** | A worker is a background process that manages tasks such as refreshing and invalidating memory caches. It ensures cache consistency by marking outdated entries for invalidation, with the cache being populated lazily during query execution. This approach maintains data freshness while optimizing resource usage. |
    | **Router** | Configures a Router Service responsible for receiving queries from Lens, managing metadata, and handling query planning and distribution to the workers. Lens communicates only with the Router, not directly with the workers.                                                                                         |

    For more information on how to configure a Lens manifest file, refer to the link:¬†[Configuration Fields of the Deployment Manifest File (YAML) for Lens Resource](https://dataos.info/resources/lens/lens_manifest_attributes/)
  </Step>

  <Step title="Apply the manifest file of Lens Resource using DataOS CLI">
    Deploy the Lens model to DataOS using the `apply` command. Replace `${manifest-file-path}` with the path to your Lens manifest file, and `${workspace}` with the name of the Workspace.

    <CodeGroup>
      ```bash Syntax
      dataos-ctl apply -f ${manifest-file-path} -w ${workspace}
      ```

      ```yaml Example
      dataos-ctl apply -f ./lens/lens.yml -w curriculum
      # Expected output
      INFO[0000] üõ† apply...                                   
      INFO[0000] üîß applying(curriculum) sales360:v1alpha:lens... 
      INFO[0001] üîß applying(curriculum) sales360:v1alpha:lens...created 
      INFO[0001] üõ† apply...complete 
      ```
    </CodeGroup>

    <Warning>
      When applying the manifest file from the DataOS CLI, make sure you specify the Workspace as Lens is a¬†[Workspace-level Resource](https://dataos.info/resources/types/#workspace-level-resources).
    </Warning>
  </Step>

  <Step title="Get the status of created Lens">
    To view the status of a Lens Resource in the DataOS environment, use the `get` command. This command provides a list of Lens models available in the specified workspace and context.

    <CodeGroup>
      ```yaml Syntax
      dataos-ctl get -t lens -w <workspace_name>
      ```

      ```
      dataos-ctl get -t lens -w curriculum
      # Expected Output
      INFO[0000] üîç get...                                     
      INFO[0000] üîç get...complete                             

            NAME     | VERSION | TYPE | WORKSPACE  | STATUS | RUNTIME |    OWNER     
      ---------------|---------|------|------------|--------|---------|--------------
          sales360   | v1alpha | lens | curriculum | active |         |  iamgroot
      ```

      ```yaml Example
      dataos-ctl get -t lens -w curriculum
      # Expected Output
      INFO[0000] üîç get...                                     
      INFO[0000] üîç get...complete                             

            NAME     | VERSION | TYPE | WORKSPACE  | STATUS | RUNTIME |    OWNER     
      ---------------|---------|------|------------|--------|---------|--------------
          sales360   | v1alpha | lens | curriculum | active |         |  iamgroot
      ```
    </CodeGroup>

    To get the details of Lens created by all the users within the DataOS Instance, use the            above command with¬†`-a `flag.

    ```yaml
    dataos-ctl get -t lens -w curriculum -a
                    # Expected Output
                    INFO[0000] üîç get...                                     
                    INFO[0000] üîç get...complete                             
          
                  NAME      | VERSION | TYPE | WORKSPACE  | STATUS | RUNTIME |    OWNER     
            ----------------|---------|------|------------|--------|---------|--------------
                sales360    | v1alpha | lens | curriculum | active |         |  iamgroot
                customer360 | v1alpha | lens | curriculum | active |         |  thor
    ```

    <Info>
      Once a Lens  is deployed, it becomes available for exploration on the Data Product Hub, enabling users to interact with the model.
    </Info>
  </Step>
</Steps>

## Next Step

Developers can further explore the Lens semantic model in the following ways:

* [Exploration of deployed Lens using SQL APIs](/resources/lens/explore_lens_using_sql_apis/)

* Exploration of deployed Lens using Python

* [Exploration of deployed Lens using REST APIs](/resources/lens/explore_lens_using_rest_apis/)

* Exploration of deployed Lens using GraphQL
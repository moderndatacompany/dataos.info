---
title: "Scanner for Lakehouse"
---

DataOS allows to create a Depot of type 'ICEBASE' to read the schemas/tables stored in DataOS‚Äôs lakehouse called Icebase. The created Depot enables the user to read the stored data in datasets, which helps in scanning metadata from the ICEBASE-type depot with the Scanner Workflows.

## **Requirements**

* To scan the ICEBASE depot, ensure that the depot is created and  have¬†`read`¬†access for the depot. To check the Depot go to the Metis UI of the DataOS or use the following command:

```bash
dataos-ctl get -t depot -a

#expected output

INFO[0000] üîç get...                                     
INFO[0000] üîç get...complete                             

            NAME            | VERSION | TYPE  | WORKSPACE | STATUS |   RUNTIME   |         OWNER          
----------------------------|---------|-------|-----------|--------|-------------|------------------------
  mongodepot                | v2alpha | depot |           | active |             | Jhon Doe
  snowflakedepot            | v2alpha | depot |           | active |             | JOJO
  redshiftdepot             | v2alpha | depot |           | active |             | Kira
  mysqldepot                | v2alpha | depot |           | active |             | Ryuk
  oracle01                  | v2alpha | depot |           | active |             | drdoom
  mariadb01                 | v2alpha | depot |           | active |             | tonystark
  demopreppostgres          | v2alpha | depot |           | active |             | slimshaddy
	demoprepbq                | v2alpha | depot |           | active |             | pengvin
  mssql01                   | v2alpha | depot |           | active |             | hulk
  kafka01                   | v2alpha | depot |           | active |             | peeter
  **icebase                   | v2alpha | depot |           | active |             | blackpink**
  azuresql                  | v2alpha | depot |           | active |             | arnold
  fastbase                  | v2alpha | depot |           | active |             | ddevil
```

If the ICEBASE Depot is not created, create a Depot using the ICEBASE Depot Template given below:

```yaml
version: v2alpha
name: "icebase"
type: depot
tags:
  - S3
layer: user
description: "AWS S3 Bucket for Data"
depot:
  type: S3
  compute: runnable-default
  s3:
    bucket: $S3_BUCKET        
    relativePath: $S3_RELATIVE_PATH           
    format: ICEBERG
    scheme: s3a       
  external: true
  secrets:
    - name: ${{icebase-s3-instance-secret-name}}-r
      allkeys: true

    - name: ${{icebase-s3-instance-secret-name}}-rw
      allkeys: true
```

* Also verify that the use case or role tag for executing a Scanner Workflow is approved, which are as follows:| Access using Role Tag | Access using Use cases         |
  | --------------------- | ------------------------------ |
  | `roles:id:data-dev`   | Read Workspace                 |
  | `roles:id:system-dev` | Run as Scanner User            |
  | `roles:id:user`       | Manage All Depot               |
  |                       | Read All Dataset               |
  |                       | Read all secrets from Heimdall |

## **Scanner Workflow**

Here is an example of manifest configuration to connect to the source and reach the Metis server to save the metadata in Metis DB. The Scanner Workflow can run with or without a filter pattern.

```yaml
version: v1
    name: scanner2-icebase-k
    type: workflow
    tags:
      - scanner
      - icebase
    description: The workflow scans Icebase Depot
    workflow:
      dag:
        - name: scanner2-icebase-job
          description: The job scans schema datasets referred to by Icebase Depot and registers in Metis2
          spec:
            tags:
              - scanner2
            stack: scanner:2.0
            compute: runnable-default
            stackSpec:
              depot: dataos://icebase
              sourceConfig: 
                config:
                  type: DatabaseMetadata
                  schemaFilterPattern:
                    includes:
                      - icebase
                    excludes:
                      - information_schema
                      - sys
                      - performance_schema
                      - innodb
```

The above sample manifest file is deployed using the following command:

```
dataos-ctl resource apply -f {path to the Scanner YAML}
```

<Note>
  If the Depot or Scanner configurations are updated, the Scanner must be redeployed after deleting the previous instance. Use the following command to delete the existing Scanner:

  ```
  dataos-ctl resource delete -f {path to the Scanner YAML file}
  ```
</Note>
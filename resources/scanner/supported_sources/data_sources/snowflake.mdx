---
title: "Scanner for Snowflake"
---
Scanner for Snowflake can scan metadata details such as schemas, tables, view details, etc., from SNOWFLAKE. All the essential requirements and sample menifest configurations to connect to SNOWFLAKE for extracting entity metadata are given below.

## **Requirements**

1. To ingest basic metadata, snowflake user must have at least¬†`USAGE`¬†privileges on required schemas.
2. While running the usage Workflow, Metis fetches the query logs by querying¬†`snowflake.account_usage.query_history`¬†table. For this the snowflake user should be granted the¬†`ACCOUNTADMIN`¬†role (or a role granted IMPORTED PRIVILEGES on the database).
3. If ingesting tags, the user should also have permissions to query¬†`snowflake.account_usage.tag_references`. For this the snowflake user should be granted the¬†`ACCOUNTADMIN`¬†role (or a role granted IMPORTED PRIVILEGES on the database)
4. If during the ingestion user want to set the session tags, then the user should have¬†`ALTER SESSION`¬†permissions.
5. Ensure that a Snowflake Depot is already created with valid read access and the necessary permissions to extract metadata. To check the Depot go to the Metis UI of the DataOS or use the following command:
    
    ```bash
    dataos-ctl get -t depot -a
    ```

    **#expected output**

    ```bash

    INFO[0000] üîç get...                                     
    INFO[0000] üîç get...complete                             
    
                NAME            | VERSION | TYPE  | WORKSPACE | STATUS |   RUNTIME   |         OWNER          
    ----------------------------|---------|-------|-----------|--------|-------------|------------------------
      mongodepot                | v2alpha | depot |           | active |             | Jhon Doe
      **snowflakedepot            | v2alpha | depot |           | active |             | JOJO**
      redshiftdepot             | v2alpha | depot |           | active |             | Kira
      mysqldepot                | v2alpha | depot |           | active |             | Ryuk
      oracle01                  | v2alpha | depot |           | active |             | drdoom
      mariadb01                 | v2alpha | depot |           | active |             | tonystark
      demopreppostgres          | v2alpha | depot |           | active |             | slimshaddy
    	demoprepbq                | v2alpha | depot |           | active |             | pengvin
      mssql01                   | v2alpha | depot |           | active |             | hulk
      kafka01                   | v2alpha | depot |           | active |             | peeter
      icebase                   | v2alpha | depot |           | active |             | blackpink
      azuresql                  | v2alpha | depot |           | active |             | arnold
      fastbase                  | v2alpha | depot |           | active |             | ddevil
    ```
    
    If the Snowflake Depot is not created, create a Depot using the Snowflake Depot Template give below: 
    
    ```yaml
    name: ${{snowflake-depot}}
    version: v2alpha
    type: depot
    tags:
      - ${{tag1}}
      - ${{tag2}}
    layer: user
    depot:
      type: snowflake
      description: ${{snowflake-depot-description}}
      snowflake:
        warehouse: ${{warehouse-name}}
        url: ${{snowflake-url}}
        database: ${{database-name}}
      external: true
      secrets:
        - name: ${{redshift-instance-secret-name}}-r
          allkeys: true
    
        - name: ${{redshift-instance-secret-name}}-rw
          allkeys: true
    ```
    
6. **Access Permission to Run a Scanner Workflow**
    Verify that the use case or role tag for executing a Scanner Workflow is approved, which are as follows:
    
    | **Access using Role Tag** | **Access using Use cases** |
    | --- | --- |
    | `roles:id:data-dev`  | Read Workspace  |
    | `roles:id:system-dev`  | Run as Scanner User  |
    | `roles:id:user`  | Manage All Depot  |
    |   | Read All Dataset  |
    |   | Read all secrets from Heimdall  |


## Scanner Workflow

Sample manifest configuration file for the Snowflake are as follows: 

```yaml
version: v1                                            
name: snowflake03-scanner2                              
type: workflow
tags:
  - snowflake03-scanner2.0
description: The job scans schema of tables and register their metadata
workflow:
  dag:
    - name: scanner2-snowflake03                        
      description: The job scans schema from snowflake03 depot tables and register their metadata on metis2
      spec:
        stack: scanner:2.0                              
        compute: runnable-default 
        runAsUser: metis                      
        stackSpec:
          depot: dataos://snowflakedepot       # Depot name or address UDL
          sourceConfig:
            config:
          #     schemaFilterPattern:
          #       includes:
          #         - Public
          #     tableFilterPattern: 
          #       includes:
          #         - department
          #         - ^EMPLOYEE
              markDeletedTables: false
              includeTables: true
              includeViews: true
```

Once the credentials of the sample file is given by the user and save with the .yam/.yml extension it can be deployed to extract the meta data by using the following command:

```bash
dataos-ctl resource apply -f {full path to}/{filename}.yml
```


After the successful workflow run, user can check the metadata of scanned Tables on Metis UI for all schemas present in the database.

<Note>
  If the Depot or Scanner configurations are updated, the Scanner must be redeployed after deleting the previous instance. Use the following command to delete the existing Scanner:

  ```bash
  dataos-ctl resource delete -f {full path to}/{filename}.yml
  ```
</Note>
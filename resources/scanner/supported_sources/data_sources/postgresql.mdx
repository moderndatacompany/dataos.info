---
title: "Scaanner for PostgreSQL"
---

To scan the PostgreSQL database, following requirements are needed:

- The user should have both¬†`CONNECT`¬†and¬†`SELECT`¬†privileges on the database.
- Check weather PostgreSQL Depot is already created. To check the Depot go to the Metis UI of the DataOS or use the following command:
    
    ```bash
    dataos-ctl get -t depot -a
    ```

    ```bash
    
    #expected output
    
    INFO[0000] üîç get...                                     
    INFO[0000] üîç get...complete                             
    
                NAME            | VERSION | TYPE  | WORKSPACE | STATUS |   RUNTIME   |         OWNER          
    ----------------------------|---------|-------|-----------|--------|-------------|------------------------
      mongodepot                | v2alpha | depot |           | active |             | Jhon Doe
      snowflakedepot            | v2alpha | depot |           | active |             | JOJO
      redshiftdepot             | v2alpha | depot |           | active |             | Kira
      mysqldepot                | v2alpha | depot |           | active |             | Ryuk
      oracle01                  | v2alpha | depot |           | active |             | drdoom
      mariadb01                 | v2alpha | depot |           | active |             | tonystark
      **demopreppostgres          | v2alpha | depot |           | active |             | slimshaddy**
      demoprepbq                | v2alpha | depot |           | active |             | pengvin
      mssql01                   | v2alpha | depot |           | active |             | hulk
      kafka01                   | v2alpha | depot |           | active |             | peeter
      icebase                   | v2alpha | depot |           | active |             | blackpink
      azuresql                  | v2alpha | depot |           | active |             | arnold
      fastbase                  | v2alpha | depot |           | active |             | ddevil
    ```
    
    If the MongoDB Depot is not created, create a Depot using the MongoDB Depot Template give below: 
    
    ```yaml
    name: ${{postgresdb}}
    version: v2alpha
    type: depot
    layer: user
    depot:
      type: JDBC                  
      description: ${{To write data to postgresql database}}
      external: ${{true}}
      secrets:
        - name: ${{sf-instance-secret-name}}-r
          allkeys: true
    
        - name: ${{sf-instance-secret-name}}-rw
          allkeys: true
      postgresql:                        
        subprotocol: "postgresql"
        host: ${{host}}
        port: ${{port}}
        database: ${{postgres}}
        params: #Required 
          sslmode: ${{disable}}
    ```
    
- **Access Permission to Run a Scanner Workflow**
    Verify that the use case or role tag for executing a Scanner Workflow is approved, which are as follows:
    
    | **Access using Role Tag** | **Access using Use cases** |
    | --- | --- |
    | `roles:id:data-dev`  | Read Workspace  |
    | `roles:id:system-dev`  | Run as Scanner User  |
    | `roles:id:user`  | Manage All Depot  |
    |   | Read All Dataset  |
    |   | Read all secrets from Heimdall  |


## **Scanner Workflow**

DataOS facilitates database connections via a JDBC driver for reading data from tables using Depot. Additionally, metadata can be scanned from a POSTGRES-type depot through Scanner Workflows. The Depot provides access to all schemas that are visible to the specified user within the configured PostGRES database.

<Info>


Ensure that the depot is created for your PostgreSQL database and you have `read` access for the depot.

</Info>

```yaml
version: v1
name: demopreppostgres-scanner2
type: workflow
tags:
  - demopreppostgres-scanner2.0
description: The job scans schema tables and register metadata
workflow:
  dag:
    - name: scanner2-demopreppostgres
      description: The job scans schema from demopreppostgres depot tables and register metadata to metis2
      spec:
        stack: scanner:2.0
        compute: runnable-default
        runAsUser: metis
        stackSpec:
          depot: demopreppostgres          # Postgres depot name
          # sourceConfig:
          #   config:
          #     schemaFilterPattern:
          #       includes:
          #         - Public
          #     tableFilterPattern:
          #       includes:
          #         - F_delivery
          
```

The above sample manifest file is deployed using the following command:

```
dataos-ctl resource apply -f {path to the Scanner YAML}
```
After the successful workflow run, user can check the metadata of scanned Tables on Metis UI for all schemas present in the database.

<Note>
  If the Depot or Scanner configurations are updated, the Scanner must be redeployed after deleting the previous instance. Use the following command to delete the existing Scanner:

  ```
  dataos-ctl resource delete -f {path to the Scanner YAML file}
  ```
</Note>